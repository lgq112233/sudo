#include "stdafx.h"
#include "sudoCreate.h"
#include "sudo.h"

extern int rowarray[9][9];
extern int colarray[9][9];
const int sudoCreate::numarray[9] ={ 3,4,5,6,7,8,9,1,2 };
sudoCreate::sudoCreate(int num)
{
	this->num = num;
	this->count = 0;
	for (int i = 0; i < 9; i++)
	{
		for (int j = 0; j < 9; j++)
		{
			this->matrix[i][j] = 0;
		}
	}
}


sudoCreate::~sudoCreate()
{}

bool sudoCreate::canFill(int i, int j, int num)
{

	return this->line[i][num] && this->column[j][num];
	//这里因为算法中是对于每个数字，是一个九宫格一个九宫格填的就不需要判断九宫格情况了

}

void sudoCreate:: fillin(int i, int j, int num)
{
	this->matrix[i][j] = num;
	this->line[i][num-1] = false;
	this->column[j][num - 1] = false;
}

void sudoCreate::erase(int i,int j,int num) {
	this->matrix[i][j] = num;
	this->line[i][num - 1] = true;
	this->column[j][num - 1] = false;
}

int sudoCreate::  choose(int index, int arrayindex,std::fstream *outfile) {
	//print(this->matrix);
	int  num = sudoCreate::numarray[arrayindex];
	//计算这次要填的数字 
	for (int i = 0; i < 9; i++) {
		/*优化：row 和 col 的计算一开始就算好了*/
		int row = rowarray[index][i];
		int col = colarray[index][i];
		if (this->canFill(row,col,num)) {
			this->fillin(row, col, num);
			if (index == 8) {
				if (arrayindex == 8) {
					//搜索成功打印结果
					sudo::print(this->matrix,outfile);
					count++;
					if (count == this->num) {
						exit(0);
					}
				}
				else {
					choose(0, arrayindex + 1,outfile);
				}
			}
			else {
				choose(index + 1, arrayindex,outfile);
			}
			this->erase(row, col, num);
		}
	}
	return 0;
}
/*void sudoCreate:: print(int matrix[9][9]) {

	for (int i = 0; i < 9; i++) {
		for (int j = 0; j < 9; j++) {
			std::cout << matrix[i][j] << " ";
		}
		std::cout << std::endl;
	}
	std::cout << std::endl;
}*/

